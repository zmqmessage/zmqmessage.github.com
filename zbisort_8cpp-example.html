<html>
    <head>
      <meta name="keywords" content="0MQ, ZeroMQ, C++, multipart, message, library, open source, ZmqMessage" />
      <meta name="description" content="ZmqMessage is free open source C++ library for sending and receiving ZeroMQ multipart messages"/>
      <meta name="google-site-verification" content="0EvtpfjffSrc0fDV9ubKQVfq3IV55KY5d59hXHg9M34" />
      <title>ZmqMessage: zbisort.cpp</title>
      <link href="doxygen.css" rel="stylesheet" type="text/css">
<style>
/* must override a few items to get the style background color */

</style>

<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-25607292-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

    </head>
    <body>

<table class="zm_headbar">
<tr>
<td>
  <span><a href="index.html">Overview</a></span>
  <span><a href="zm_tutorial.html">Tutorial</a></span>
  <span><a href="namespaceZmqMessage.html">API reference</a></span>
  <span><a href="examples.html">Examples</a></span>
  <span><a href="zm_build.html">Build</a></span>
  <span><a href="https://github.com/zmqmessage/zmqmessage/">Download</a></span>
</td>

<td align="right" class="zm_greynote">ZmqMessage 0.1 - 21 Oct 2011</td>

</tr></table>

<hr style="height: 3px;">
<!-- Generated by Doxygen 1.4.7 -->
<h1>zbisort.cpp</h1>This is a little more complex example. Demonstrates Text and Binary modes, iterators, message relaying.<p>
Main thread starts a relay thread (<code><a class="el" href="zbisort_8cpp.html#b81a4ad0058b6ebca75f9d65214b1571">relay(void*)</a></code>). It in turn starts two sorting workers. One worker is sorting incoming messages as integers (<code><a class="el" href="zsort_8cpp.html#8a8a4c174bee5774fb3e883e1eddffb5">sorter&lt;int&gt;(void*)</a></code>) in numeric order, and the second one (<code><a class="el" href="zsort_8cpp.html#8a8a4c174bee5774fb3e883e1eddffb5">sorter&lt;StringFace&gt;(void*)</a></code>) is sorting as strings (in alphanumeric order). Relay thread is a dispatcher: it reads first message ("mode" message, it can be either "INT", "STRING" or "STOP") and relays all tail message parts to appropriate worker. Response from worker is relayed back to main thread.<p>
Also we implemented simple class <a class="el" href="classStringFace.html">StringFace</a> that conforms to string concept (see <a class="el" href="Config_8hpp.html#4c1baa6349b90bb0dc128873a3c282fc">ZMQMESSAGE_STRING_CLASS</a> for description) and just wraps external memory to avoid intermediate copying while sorting.<p>
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00010"></a>00010 <span class="preprocessor">#include "pthread.h"</span>
<a name="l00011"></a>00011 <span class="preprocessor">#include &lt;vector&gt;</span>
<a name="l00012"></a>00012 
<a name="l00013"></a>00013 <span class="preprocessor">#include &lt;zmq.hpp&gt;</span>
<a name="l00014"></a>00014 
<a name="l00015"></a>00015 <span class="preprocessor">#include "<a class="code" href="ZmqMessage_8hpp.html">ZmqMessage.hpp</a>"</span>
<a name="l00016"></a>00016 
<a name="l00017"></a>00017 <span class="preprocessor">#include "<a class="code" href="StringFace_8hpp.html">StringFace.hpp</a>"</span>
<a name="l00018"></a>00018 
<a name="l00039"></a>00039 <span class="comment">// 0mq context is globally available</span>
<a name="l00040"></a>00040 zmq::context_t <a name="a24"></a><a class="code" href="zasync_8cpp.html#dfc676557ead71d2d6a26f06c84409fe">ctx</a>(1);
<a name="l00041"></a>00041 
<a name="l00042"></a>00042 <span class="comment">// endpoint to pass data from main thread to relay and back</span>
<a name="l00043"></a>00043 <span class="keyword">const</span> <span class="keywordtype">char</span>* <a name="a25"></a><a class="code" href="zbisort_8cpp.html#7ad67a6c519be251e51d680bbbe42793">relay_endpoint</a> = <span class="stringliteral">"inproc://relay"</span>;
<a name="l00044"></a>00044 <span class="comment">// endpoints to pass data from realy thread to string and numeric workers and back</span>
<a name="l00045"></a>00045 <span class="keyword">const</span> <span class="keywordtype">char</span>* <a name="a26"></a><a class="code" href="zbisort_8cpp.html#26e8558e19c0d51bdcd2c865a1b740ed">string_endpoint</a> = <span class="stringliteral">"inproc://string"</span>;
<a name="l00046"></a>00046 <span class="keyword">const</span> <span class="keywordtype">char</span>* <a name="a27"></a><a class="code" href="zbisort_8cpp.html#28c32e66720918c5d1702176fff11aff">int_endpoint</a> = <span class="stringliteral">"inproc://int"</span>;
<a name="l00047"></a>00047 
<a name="l00048"></a>00048 <span class="keyword">const</span> std::string <a name="a28"></a><a class="code" href="zbisort_8cpp.html#f1f1d0c97415345526ed37068bd8f911">int_mode</a> = <span class="stringliteral">"INT"</span>;
<a name="l00049"></a>00049 <span class="keyword">const</span> std::string <a name="a29"></a><a class="code" href="zbisort_8cpp.html#905b8db1dd2c6fe5dda56d909e1a7248">string_mode</a> = <span class="stringliteral">"STRING"</span>;
<a name="l00050"></a>00050 <span class="keyword">const</span> std::string <a name="a30"></a><a class="code" href="zbisort_8cpp.html#8d8a2e6d853ed6c9e78ee59439b77314">stop_mode</a> = <span class="stringliteral">"STOP"</span>;
<a name="l00051"></a>00051 
<a name="l00052"></a>00052 <span class="comment">// worker run in a dedicated thread. Launched by relay thread.</span>
<a name="l00053"></a>00053 <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;
<a name="l00054"></a>00054 <span class="keywordtype">void</span>*
<a name="l00055"></a>00055 <a name="a31"></a><a class="code" href="zbisort_8cpp.html#20094e60b10d15bb44ee34644398baff">sorter</a>(<span class="keywordtype">void</span>* <a name="a32"></a><a class="code" href="zqueue_8cpp.html#7467cad923c237f39ed035428e96b5b9">endpoint</a>)
<a name="l00056"></a>00056 {
<a name="l00057"></a>00057   <span class="keywordflow">try</span>
<a name="l00058"></a>00058   {
<a name="l00059"></a>00059     zmq::socket_t s(<a class="code" href="zasync_8cpp.html#dfc676557ead71d2d6a26f06c84409fe">ctx</a>, ZMQ_REP);
<a name="l00060"></a>00060     s.connect(static_cast&lt;char*&gt;(endpoint));
<a name="l00061"></a>00061     std::cout &lt;&lt; <span class="stringliteral">"connected to "</span> &lt;&lt; static_cast&lt;char*&gt;(endpoint) &lt;&lt; std::endl;
<a name="l00062"></a>00062     <span class="comment">// socket to receive data from main thread and to send result back</span>
<a name="l00063"></a>00063     <span class="comment">//   is connected</span>
<a name="l00064"></a>00064 
<a name="l00065"></a>00065     <span class="keywordflow">for</span>(;;)
<a name="l00066"></a>00066     {
<a name="l00067"></a>00067       <a name="_a33"></a><a class="code" href="classZmqMessage_1_1Incoming.html">ZmqMessage::Incoming&lt;ZmqMessage::SimpleRouting&gt;</a> ingress(s);
<a name="l00068"></a>00068       ingress.receive_all();
<a name="l00069"></a>00069       <span class="comment">// all parts of incoming message are received</span>
<a name="l00070"></a>00070 
<a name="l00071"></a>00071       <span class="keywordflow">if</span> (ingress.size() == 1)
<a name="l00072"></a>00072       {
<a name="l00073"></a>00073         <span class="comment">// treat one-part mesages as termination marker</span>
<a name="l00074"></a>00074         std::cout &lt;&lt; <span class="stringliteral">"leaving ..."</span> &lt;&lt; std::endl;
<a name="l00075"></a>00075         <span class="keywordflow">return</span> 0;
<a name="l00076"></a>00076       }
<a name="l00077"></a>00077 
<a name="l00078"></a>00078       std::vector&lt;T&gt; sort_area;
<a name="l00079"></a>00079 
<a name="l00080"></a>00080       std::copy(ingress.begin&lt;T&gt;(),
<a name="l00081"></a>00081                 ingress.end&lt;T&gt;(),
<a name="l00082"></a>00082                 std::back_inserter(sort_area));
<a name="l00083"></a>00083       <span class="comment">// every message part is a vector element now</span>
<a name="l00084"></a>00084 
<a name="l00085"></a>00085       std::sort(sort_area.begin(), sort_area.end());
<a name="l00086"></a>00086       <span class="comment">// they are sorted according to type</span>
<a name="l00087"></a>00087 
<a name="l00088"></a>00088       <a name="_a34"></a><a class="code" href="classZmqMessage_1_1Outgoing.html">ZmqMessage::Outgoing&lt;ZmqMessage::SimpleRouting&gt;</a> egress(s, 0);
<a name="l00089"></a>00089 
<a name="l00090"></a>00090       std::copy(sort_area.begin(),
<a name="l00091"></a>00091                 sort_area.end(),
<a name="l00092"></a>00092                 <a class="code" href="classZmqMessage_1_1Outgoing.html">ZmqMessage::Outgoing&lt;ZmqMessage::SimpleRouting&gt;::iterator</a>&lt;T&gt;(egress));
<a name="l00093"></a>00093       <span class="comment">// put to outgoing container</span>
<a name="l00094"></a>00094 
<a name="l00095"></a>00095       egress.flush();
<a name="l00096"></a>00096       <span class="comment">// and sent to the main thread</span>
<a name="l00097"></a>00097     }
<a name="l00098"></a>00098   }
<a name="l00099"></a>00099   <span class="keywordflow">catch</span>(<span class="keyword">const</span> std::exception&amp; ex)
<a name="l00100"></a>00100   {
<a name="l00101"></a>00101     std::cout &lt;&lt; <span class="stringliteral">"caught (worker): "</span> &lt;&lt; ex.what();
<a name="l00102"></a>00102     exit(3);
<a name="l00103"></a>00103   }
<a name="l00104"></a>00104 
<a name="l00105"></a>00105   <span class="keywordflow">return</span> 0;
<a name="l00106"></a>00106 }
<a name="l00107"></a>00107 
<a name="l00108"></a>00108 <span class="keywordtype">void</span>*
<a name="l00109"></a>00109 <a name="a35"></a><a class="code" href="zbisort_8cpp.html#b81a4ad0058b6ebca75f9d65214b1571">relay</a>(<span class="keywordtype">void</span>*)
<a name="l00110"></a>00110 {
<a name="l00111"></a>00111   pthread_t string_tid;
<a name="l00112"></a>00112   pthread_t int_tid;
<a name="l00113"></a>00113 
<a name="l00114"></a>00114   <span class="keywordflow">try</span>
<a name="l00115"></a>00115   {
<a name="l00116"></a>00116     zmq::socket_t <a class="code" href="zbisort_8cpp.html#b81a4ad0058b6ebca75f9d65214b1571">relay</a>(<a class="code" href="zasync_8cpp.html#dfc676557ead71d2d6a26f06c84409fe">ctx</a>, ZMQ_REP);
<a name="l00117"></a>00117     <a class="code" href="zbisort_8cpp.html#b81a4ad0058b6ebca75f9d65214b1571">relay</a>.connect(relay_endpoint);
<a name="l00118"></a>00118 
<a name="l00119"></a>00119     zmq::socket_t s(<a class="code" href="zasync_8cpp.html#dfc676557ead71d2d6a26f06c84409fe">ctx</a>, ZMQ_REQ);
<a name="l00120"></a>00120     s.bind(string_endpoint);
<a name="l00121"></a>00121 
<a name="l00122"></a>00122     zmq::socket_t i(<a class="code" href="zasync_8cpp.html#dfc676557ead71d2d6a26f06c84409fe">ctx</a>, ZMQ_REQ);
<a name="l00123"></a>00123     i.bind(int_endpoint);
<a name="l00124"></a>00124 
<a name="l00125"></a>00125     <span class="comment">// start workers</span>
<a name="l00126"></a>00126     pthread_create(&amp;string_tid, 0, sorter&lt;StringFace&gt;, const_cast&lt;char*&gt;(string_endpoint));
<a name="l00127"></a>00127     pthread_create(&amp;int_tid, 0, sorter&lt;int&gt;, const_cast&lt;char*&gt;(int_endpoint));
<a name="l00128"></a>00128 
<a name="l00129"></a>00129     <span class="keywordflow">for</span>(;;)
<a name="l00130"></a>00130     {
<a name="l00131"></a>00131       <a class="code" href="classZmqMessage_1_1Incoming.html">ZmqMessage::Incoming&lt;ZmqMessage::SimpleRouting&gt;</a> ingress(<a class="code" href="zbisort_8cpp.html#b81a4ad0058b6ebca75f9d65214b1571">relay</a>);
<a name="l00132"></a>00132       ingress.receive(1, <span class="keyword">false</span>);
<a name="l00133"></a>00133 
<a name="l00134"></a>00134       <a name="_a36"></a><a class="code" href="classStringFace.html">StringFace</a> mode;
<a name="l00135"></a>00135       ingress &gt;&gt; mode;
<a name="l00136"></a>00136 
<a name="l00137"></a>00137       <span class="keywordflow">if</span> (mode == int_mode)
<a name="l00138"></a>00138       {
<a name="l00139"></a>00139         <a class="code" href="classZmqMessage_1_1Outgoing.html">ZmqMessage::Outgoing&lt;ZmqMessage::SimpleRouting&gt;</a> to_int(i, 0);
<a name="l00140"></a>00140         to_int.relay_from(<a class="code" href="zbisort_8cpp.html#b81a4ad0058b6ebca75f9d65214b1571">relay</a>);
<a name="l00141"></a>00141         <span class="comment">// request is read</span>
<a name="l00142"></a>00142         to_int &lt;&lt; 38 &lt;&lt; <a name="a37"></a><a class="code" href="namespaceZmqMessage.html#d91dfdcb44a38c67cb7c8acbf4096a53">ZmqMessage::Flush</a>;
<a name="l00143"></a>00143         <span class="comment">// extra stuff added. sent to worker.</span>
<a name="l00144"></a>00144 
<a name="l00145"></a>00145         <a name="a38"></a><a class="code" href="namespaceZmqMessage.html#9b00f09bfd307effbb7f1b8af895ad13">ZmqMessage::relay_raw</a>(i, <a class="code" href="zbisort_8cpp.html#b81a4ad0058b6ebca75f9d65214b1571">relay</a>, <span class="keyword">false</span>);
<a name="l00146"></a>00146         <span class="comment">// answer from worker resent to main thread</span>
<a name="l00147"></a>00147       }
<a name="l00148"></a>00148       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mode == string_mode)
<a name="l00149"></a>00149       {
<a name="l00150"></a>00150         <a class="code" href="classZmqMessage_1_1Outgoing.html">ZmqMessage::Outgoing&lt;ZmqMessage::SimpleRouting&gt;</a> to_string(s, 0);
<a name="l00151"></a>00151         to_string.relay_from(<a class="code" href="zbisort_8cpp.html#b81a4ad0058b6ebca75f9d65214b1571">relay</a>);
<a name="l00152"></a>00152         to_string &lt;&lt; <span class="stringliteral">"some addition"</span> &lt;&lt; <a class="code" href="namespaceZmqMessage.html#d91dfdcb44a38c67cb7c8acbf4096a53">ZmqMessage::Flush</a>;
<a name="l00153"></a>00153 
<a name="l00154"></a>00154         <a class="code" href="namespaceZmqMessage.html#9b00f09bfd307effbb7f1b8af895ad13">ZmqMessage::relay_raw</a>(s, <a class="code" href="zbisort_8cpp.html#b81a4ad0058b6ebca75f9d65214b1571">relay</a>, <span class="keyword">false</span>);
<a name="l00155"></a>00155         <span class="comment">// answer from worker resent to main thread</span>
<a name="l00156"></a>00156       }
<a name="l00157"></a>00157       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mode == stop_mode)
<a name="l00158"></a>00158       {
<a name="l00159"></a>00159         <a class="code" href="classZmqMessage_1_1Outgoing.html">ZmqMessage::Outgoing&lt;ZmqMessage::SimpleRouting&gt;</a> to_stop_int(i, 0);
<a name="l00160"></a>00160         to_stop_int &lt;&lt; stop_mode &lt;&lt; <a class="code" href="namespaceZmqMessage.html#d91dfdcb44a38c67cb7c8acbf4096a53">ZmqMessage::Flush</a>;
<a name="l00161"></a>00161 
<a name="l00162"></a>00162         <a class="code" href="classZmqMessage_1_1Outgoing.html">ZmqMessage::Outgoing&lt;ZmqMessage::SimpleRouting&gt;</a> to_stop_string(s, 0);
<a name="l00163"></a>00163         to_stop_string &lt;&lt; stop_mode &lt;&lt; ZmqMessage::Flush;
<a name="l00164"></a>00164 
<a name="l00165"></a>00165         <span class="keywordflow">break</span>;
<a name="l00166"></a>00166       }
<a name="l00167"></a>00167       <span class="keywordflow">else</span>
<a name="l00168"></a>00168       {
<a name="l00169"></a>00169         assert(!<span class="stringliteral">"Unknown mode"</span>);
<a name="l00170"></a>00170       }
<a name="l00171"></a>00171     }
<a name="l00172"></a>00172   }
<a name="l00173"></a>00173   <span class="keywordflow">catch</span>(<span class="keyword">const</span> std::exception&amp; ex)
<a name="l00174"></a>00174   {
<a name="l00175"></a>00175     std::cout &lt;&lt; <span class="stringliteral">"caught (relay): "</span> &lt;&lt; ex.what();
<a name="l00176"></a>00176     exit(3);
<a name="l00177"></a>00177   }
<a name="l00178"></a>00178 
<a name="l00179"></a>00179   pthread_join(string_tid, 0);
<a name="l00180"></a>00180   pthread_join(int_tid, 0);
<a name="l00181"></a>00181   <span class="comment">// worker threads are completed and sockets are closed</span>
<a name="l00182"></a>00182 
<a name="l00183"></a>00183   <span class="keywordflow">return</span> 0;
<a name="l00184"></a>00184 }
<a name="l00185"></a>00185 
<a name="l00186"></a>00186 <span class="keywordtype">int</span>
<a name="l00187"></a>00187 <a name="a39"></a><a class="code" href="zasync_8cpp.html#4b097df32a52205a4c919b840eba55fc">main</a>(<span class="keywordtype">int</span>, <span class="keywordtype">char</span>**)
<a name="l00188"></a>00188 {
<a name="l00189"></a>00189   pthread_t relay_tid;
<a name="l00190"></a>00190 
<a name="l00191"></a>00191   <span class="keywordflow">try</span>
<a name="l00192"></a>00192   {
<a name="l00193"></a>00193     zmq::socket_t s(<a class="code" href="zasync_8cpp.html#dfc676557ead71d2d6a26f06c84409fe">ctx</a>, ZMQ_REQ);
<a name="l00194"></a>00194     s.bind(relay_endpoint);
<a name="l00195"></a>00195     <span class="comment">// socket to talk to worker is bound</span>
<a name="l00196"></a>00196 
<a name="l00197"></a>00197     <span class="comment">// start relay</span>
<a name="l00198"></a>00198     pthread_create(&amp;relay_tid, 0, <a class="code" href="zbisort_8cpp.html#b81a4ad0058b6ebca75f9d65214b1571">relay</a>, 0);
<a name="l00199"></a>00199 
<a name="l00200"></a>00200     {
<a name="l00201"></a>00201       std::vector&lt;std::string&gt; desc;
<a name="l00202"></a>00202 
<a name="l00203"></a>00203       <span class="comment">// populate 'zzzzzzzzzz' ... 'aaaaaaaaaa' string</span>
<a name="l00204"></a>00204       <span class="keywordflow">for</span> (<span class="keywordtype">char</span> letter = <span class="charliteral">'z'</span>; letter &gt;= <span class="charliteral">'a'</span>; --letter)
<a name="l00205"></a>00205       {
<a name="l00206"></a>00206         std::string part(10, letter);
<a name="l00207"></a>00207         desc.push_back(part);
<a name="l00208"></a>00208       }
<a name="l00209"></a>00209 
<a name="l00210"></a>00210       std::cout &lt;&lt; <span class="stringliteral">"Original array:"</span> &lt;&lt; std::endl;
<a name="l00211"></a>00211       std::copy(desc.begin(), desc.end(),
<a name="l00212"></a>00212                 std::ostream_iterator&lt;std::string&gt;(std::cout, <span class="stringliteral">"\n"</span>));
<a name="l00213"></a>00213 
<a name="l00214"></a>00214       <a class="code" href="classZmqMessage_1_1Outgoing.html">ZmqMessage::Outgoing&lt;ZmqMessage::SimpleRouting&gt;</a> to_sort(s, 0);
<a name="l00215"></a>00215 
<a name="l00216"></a>00216       to_sort &lt;&lt; string_mode;
<a name="l00217"></a>00217       std::copy(desc.begin(), desc.end(),
<a name="l00218"></a>00218                 <a class="code" href="classZmqMessage_1_1Outgoing.html">ZmqMessage::Outgoing&lt;ZmqMessage::SimpleRouting&gt;::iterator</a>&lt;std::string&gt;(to_sort));
<a name="l00219"></a>00219       <span class="comment">// strings are in outgoing container</span>
<a name="l00220"></a>00220 
<a name="l00221"></a>00221       to_sort.flush();
<a name="l00222"></a>00222       <span class="comment">// outgoing container content is sent</span>
<a name="l00223"></a>00223 
<a name="l00224"></a>00224       <a class="code" href="classZmqMessage_1_1Incoming.html">ZmqMessage::Incoming&lt;ZmqMessage::SimpleRouting&gt;</a> sorted(s);
<a name="l00225"></a>00225       sorted.receive_all(0, 0);
<a name="l00226"></a>00226       <span class="comment">// worker response received</span>
<a name="l00227"></a>00227 
<a name="l00228"></a>00228       std::vector&lt;std::string&gt; asc;
<a name="l00229"></a>00229 
<a name="l00230"></a>00230       std::copy(sorted.begin&lt;std::string&gt;(), sorted.end&lt;std::string&gt;(),
<a name="l00231"></a>00231                 std::back_inserter(asc));
<a name="l00232"></a>00232       <span class="comment">// copied to vector</span>
<a name="l00233"></a>00233 
<a name="l00234"></a>00234       std::cout &lt;&lt; <span class="stringliteral">"Sorted array:"</span> &lt;&lt; std::endl;
<a name="l00235"></a>00235       std::copy(asc.begin(), asc.end(),
<a name="l00236"></a>00236                 std::ostream_iterator&lt;std::string&gt;(std::cout, <span class="stringliteral">"\n"</span>));
<a name="l00237"></a>00237       <span class="comment">// and printed out to demonstracte it is in ascending order</span>
<a name="l00238"></a>00238     }
<a name="l00239"></a>00239 
<a name="l00240"></a>00240     {
<a name="l00241"></a>00241       std::vector&lt;int&gt; desc;
<a name="l00242"></a>00242 
<a name="l00243"></a>00243       <span class="comment">// populate 100 ... 90 numbers</span>
<a name="l00244"></a>00244       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> number = 100; number &gt;= 90; --number)
<a name="l00245"></a>00245       {
<a name="l00246"></a>00246         desc.push_back(number);
<a name="l00247"></a>00247       }
<a name="l00248"></a>00248 
<a name="l00249"></a>00249 
<a name="l00250"></a>00250       std::cout &lt;&lt; <span class="stringliteral">"Original array:"</span> &lt;&lt; std::endl;
<a name="l00251"></a>00251       std::copy(desc.begin(), desc.end(),
<a name="l00252"></a>00252                 std::ostream_iterator&lt;int&gt;(std::cout, <span class="stringliteral">"\n"</span>));
<a name="l00253"></a>00253 
<a name="l00254"></a>00254       <a class="code" href="classZmqMessage_1_1Outgoing.html">ZmqMessage::Outgoing&lt;ZmqMessage::SimpleRouting&gt;</a> to_sort(s, 0);
<a name="l00255"></a>00255 
<a name="l00256"></a>00256       to_sort &lt;&lt; int_mode;
<a name="l00257"></a>00257 
<a name="l00258"></a>00258       to_sort &lt;&lt; 950;
<a name="l00259"></a>00259       <span class="comment">// to prove we do numeric sort</span>
<a name="l00260"></a>00260 
<a name="l00261"></a>00261       std::copy(desc.begin(), desc.end(),
<a name="l00262"></a>00262                 <a class="code" href="classZmqMessage_1_1Outgoing.html">ZmqMessage::Outgoing&lt;ZmqMessage::SimpleRouting&gt;::iterator</a>&lt;<span class="keywordtype">int</span>&gt;(to_sort));
<a name="l00263"></a>00263       <span class="comment">// numbers are in outgoing container</span>
<a name="l00264"></a>00264 
<a name="l00265"></a>00265       to_sort.flush();
<a name="l00266"></a>00266       <span class="comment">// outgoing container content is sent</span>
<a name="l00267"></a>00267 
<a name="l00268"></a>00268       <a class="code" href="classZmqMessage_1_1Incoming.html">ZmqMessage::Incoming&lt;ZmqMessage::SimpleRouting&gt;</a> sorted(s);
<a name="l00269"></a>00269       sorted.receive_all(0, 0);
<a name="l00270"></a>00270       <span class="comment">// worker response received</span>
<a name="l00271"></a>00271 
<a name="l00272"></a>00272       std::vector&lt;int&gt; asc;
<a name="l00273"></a>00273 
<a name="l00274"></a>00274       std::copy(sorted.begin&lt;<span class="keywordtype">int</span>&gt;(), sorted.end&lt;<span class="keywordtype">int</span>&gt;(),
<a name="l00275"></a>00275                 std::back_inserter(asc));
<a name="l00276"></a>00276       <span class="comment">// copied to vector</span>
<a name="l00277"></a>00277 
<a name="l00278"></a>00278       std::cout &lt;&lt; <span class="stringliteral">"Sorted array:"</span> &lt;&lt; std::endl;
<a name="l00279"></a>00279       std::copy(asc.begin(), asc.end(),
<a name="l00280"></a>00280                 std::ostream_iterator&lt;int&gt;(std::cout, <span class="stringliteral">"\n"</span>));
<a name="l00281"></a>00281       <span class="comment">// and printed out to demonstracte it is in ascending order</span>
<a name="l00282"></a>00282     }
<a name="l00283"></a>00283 
<a name="l00284"></a>00284 
<a name="l00285"></a>00285     <a class="code" href="classZmqMessage_1_1Outgoing.html">ZmqMessage::Outgoing&lt;ZmqMessage::SimpleRouting&gt;</a> to_stop(s, 0);
<a name="l00286"></a>00286     to_stop &lt;&lt; stop_mode;<span class="comment">// &lt;&lt; ZmqMessage::Flush;</span>
<a name="l00287"></a>00287     to_stop.flush();
<a name="l00288"></a>00288     <span class="comment">// send termination marker to worker</span>
<a name="l00289"></a>00289   }
<a name="l00290"></a>00290   <span class="keywordflow">catch</span>(<span class="keyword">const</span> std::exception&amp; ex)
<a name="l00291"></a>00291   {
<a name="l00292"></a>00292     std::cout &lt;&lt; <span class="stringliteral">"caught (main): "</span> &lt;&lt; ex.what();
<a name="l00293"></a>00293     exit(3);
<a name="l00294"></a>00294   }
<a name="l00295"></a>00295 
<a name="l00296"></a>00296   pthread_join(relay_tid, 0);
<a name="l00297"></a>00297   <span class="comment">// relay thread is completed and sockets are closed</span>
<a name="l00298"></a>00298 }
</pre></div> 
<hr style="height: 3px;">

<div class="zm_greynote">
ZmqMessage 0.1 &mdash; open source software, <a href="mailto:support@zmqmessage.org">support@zmqmessage.org</a>
</div>

</body>
</html>
